{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/disco_lu/link-share-pwa/app/lib/email.ts"],"sourcesContent":["import { Resend } from 'resend'\n\nif (!process.env.RESEND_API_KEY) {\n  throw new Error('RESEND_API_KEY is not set')\n}\n\nconst resend = new Resend(process.env.RESEND_API_KEY)\n\nexport async function sendVerificationEmail(email: string, code: string) {\n  console.log('Attempting to send email to:', email)\n  \n  try {\n    console.log('Creating email with Resend...')\n    const { data, error } = await resend.emails.send({\n      from: 'LinkShare <onboarding@resend.dev>',\n      to: email,\n      subject: 'Your verification code for LinkShare',\n      html: `\n        <div style=\"font-family: sans-serif; max-width: 600px; margin: 0 auto;\">\n          <h1 style=\"color: #1a1a1a; text-align: center;\">Your verification code</h1>\n          <p style=\"color: #444; font-size: 16px;\">Here's your verification code for LinkShare:</p>\n          <div style=\"background: #f4f4f4; padding: 16px; border-radius: 4px; text-align: center; font-size: 24px; font-weight: bold; margin: 16px 0;\">\n            ${code}\n          </div>\n          <p style=\"color: #444; font-size: 16px;\">This code will expire in 15 minutes. If you didn't request this code, you can safely ignore this email.</p>\n        </div>\n      `,\n    })\n\n    if (error) {\n      console.error('Resend API error:', error)\n      throw error\n    }\n\n    console.log('Resend API response:', data)\n    return data\n  } catch (error) {\n    console.error('Error in sendVerificationEmail:', error)\n    if (error instanceof Error) {\n      console.error('Error details:', {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      })\n    }\n    throw error\n  }\n} "],"names":[],"mappings":";;;AAAA;;AAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;IAC/B,MAAM,IAAI,MAAM;AAClB;AAEA,MAAM,SAAS,IAAI,0IAAA,CAAA,SAAM,CAAC,QAAQ,GAAG,CAAC,cAAc;AAE7C,eAAe,sBAAsB,KAAa,EAAE,IAAY;IACrE,QAAQ,GAAG,CAAC,gCAAgC;IAE5C,IAAI;QACF,QAAQ,GAAG,CAAC;QACZ,MAAM,EAAE,IAAI,EAAE,KAAK,EAAE,GAAG,MAAM,OAAO,MAAM,CAAC,IAAI,CAAC;YAC/C,MAAM;YACN,IAAI;YACJ,SAAS;YACT,MAAM,CAAC;;;;;YAKD,EAAE,KAAK;;;;MAIb,CAAC;QACH;QAEA,IAAI,OAAO;YACT,QAAQ,KAAK,CAAC,qBAAqB;YACnC,MAAM;QACR;QAEA,QAAQ,GAAG,CAAC,wBAAwB;QACpC,OAAO;IACT,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mCAAmC;QACjD,IAAI,iBAAiB,OAAO;YAC1B,QAAQ,KAAK,CAAC,kBAAkB;gBAC9B,MAAM,MAAM,IAAI;gBAChB,SAAS,MAAM,OAAO;gBACtB,OAAO,MAAM,KAAK;YACpB;QACF;QACA,MAAM;IACR;AACF","debugId":null}},
    {"offset": {"line": 176, "column": 0}, "map": {"version":3,"sources":["file:///Users/disco_lu/link-share-pwa/app/api/auth/generate-code/route.ts"],"sourcesContent":["import { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs'\nimport { cookies } from 'next/headers'\nimport { NextResponse } from 'next/server'\nimport { sendVerificationEmail } from '@/app/lib/email'\n\nexport async function POST(request: Request) {\n  try {\n    console.log('Generate code API called')\n    const { email } = await request.json()\n    console.log('Email received:', email)\n\n    const supabase = createRouteHandlerClient({ cookies })\n\n    // Check rate limits\n    console.log('Checking rate limits...')\n    const { data: rateLimit, error: rateLimitError } = await supabase\n      .from('email_rate_limits')\n      .select('*')\n      .eq('email', email)\n      .single()\n\n    if (rateLimitError && rateLimitError.code !== 'PGRST116') {\n      console.error('Error checking rate limits:', rateLimitError)\n      return NextResponse.json(\n        { error: rateLimitError.message },\n        { status: 500 }\n      )\n    }\n\n    const now = new Date()\n    const hourAgo = new Date(now.getTime() - 60 * 60 * 1000)\n\n    // Update or create rate limit record\n    console.log('Updating rate limit record...')\n    const { error: upsertError } = await supabase\n      .from('email_rate_limits')\n      .upsert({\n        email,\n        last_code_sent_at: now.toISOString(),\n        codes_sent_in_last_hour: rateLimit ? (\n          new Date(rateLimit.last_reset_at) < hourAgo ? 1 : rateLimit.codes_sent_in_last_hour + 1\n        ) : 1,\n        last_reset_at: rateLimit && new Date(rateLimit.last_reset_at) < hourAgo ? now.toISOString() : rateLimit?.last_reset_at || now.toISOString()\n      }, {\n        onConflict: 'email'\n      })\n\n    if (upsertError) {\n      console.error('Error upserting rate limit:', upsertError)\n      return NextResponse.json(\n        { error: upsertError.message },\n        { status: 500 }\n      )\n    }\n\n    // Check if we've hit the rate limit\n    if (rateLimit) {\n      if (new Date(rateLimit.last_reset_at) < hourAgo) {\n        console.log('Rate limit was reset')\n      } else if (rateLimit.codes_sent_in_last_hour >= 5) {\n        console.log('Rate limit exceeded')\n        return NextResponse.json(\n          { error: 'Too many code requests. Please wait before requesting another code.' },\n          { status: 429 }\n        )\n      }\n    }\n\n    // Check active codes\n    console.log('Checking active codes...')\n    const { data: activeCodes, error: activeCodesError } = await supabase\n      .from('email_codes')\n      .select('*')\n      .eq('email', email)\n      .eq('used', false)\n      .gt('expires_at', now.toISOString())\n\n    if (activeCodesError) {\n      console.error('Error checking active codes:', activeCodesError)\n      return NextResponse.json(\n        { error: activeCodesError.message },\n        { status: 500 }\n      )\n    }\n\n    if (activeCodes && activeCodes.length >= 3) {\n      console.log('Too many active codes')\n      return NextResponse.json(\n        { error: 'You have too many active codes. Please use an existing code or wait for it to expire.' },\n        { status: 429 }\n      )\n    }\n\n    // Generate and insert the new code\n    console.log('Generating new code...')\n    const code = generateRandomCode(12)\n    const { error: insertError } = await supabase\n      .from('email_codes')\n      .insert({\n        email,\n        code,\n        expires_at: new Date(Date.now() + 15 * 60 * 1000).toISOString() // 15 minutes from now\n      })\n\n    if (insertError) {\n      console.error('Error inserting code:', insertError)\n      return NextResponse.json(\n        { error: insertError.message },\n        { status: 500 }\n      )\n    }\n\n    // Send the code via email\n    try {\n      console.log('Attempting to send email...')\n      await sendVerificationEmail(email, code)\n      console.log('Email sent successfully')\n    } catch (emailError) {\n      console.error('Error sending email:', emailError)\n      if (emailError instanceof Error) {\n        console.error('Email error details:', {\n          name: emailError.name,\n          message: emailError.message,\n          stack: emailError.stack\n        })\n      }\n      return NextResponse.json(\n        { error: 'Failed to send email' },\n        { status: 500 }\n      )\n    }\n\n    return NextResponse.json({ success: true })\n  } catch (error) {\n    console.error('Error in generate-code API:', error)\n    if (error instanceof Error) {\n      console.error('API error details:', {\n        name: error.name,\n        message: error.message,\n        stack: error.stack\n      })\n    }\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Failed to generate code' },\n      { status: 500 }\n    )\n  }\n}\n\nfunction generateRandomCode(length: number): string {\n  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'\n  let result = ''\n  for (let i = 0; i < length; i++) {\n    result += chars.charAt(Math.floor(Math.random() * chars.length))\n  }\n  return result\n} "],"names":[],"mappings":"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","debugId":null}}]
}