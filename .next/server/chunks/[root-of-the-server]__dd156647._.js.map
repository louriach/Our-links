{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 124, "column": 0}, "map": {"version":3,"sources":["file:///Users/disco_lu/link-share-pwa/app/api/unfurl/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server'\nimport { createRouteHandlerClient } from '@supabase/auth-helpers-nextjs'\nimport { cookies } from 'next/headers'\n\nexport async function POST(request: Request) {\n  try {\n    const supabase = createRouteHandlerClient({ cookies })\n    const { url } = await request.json()\n\n    // Check authentication\n    const { data: { session } } = await supabase.auth.getSession()\n    if (!session) {\n      return NextResponse.json({ error: 'Unauthorized' }, { status: 401 })\n    }\n\n    // Validate URL\n    let validUrl: URL\n    try {\n      validUrl = new URL(url)\n    } catch (e) {\n      return NextResponse.json({ error: 'Invalid URL' }, { status: 400 })\n    }\n\n    // Fetch URL metadata with timeout\n    const controller = new AbortController()\n    const timeoutId = setTimeout(() => controller.abort(), 5000) // 5 second timeout\n\n    try {\n      const response = await fetch(validUrl.toString(), {\n        signal: controller.signal,\n        headers: {\n          'User-Agent': 'Mozilla/5.0 (compatible; LinkShare/1.0)',\n        },\n      })\n\n      if (!response.ok) {\n        throw new Error(`HTTP error! status: ${response.status}`)\n      }\n\n      const html = await response.text()\n\n      // Basic metadata extraction\n      const title = html.match(/<title[^>]*>([^<]+)<\\/title>/)?.[1] || ''\n      const description = html.match(/<meta[^>]*name=\"description\"[^>]*content=\"([^\"]*)\"[^>]*>/)?.[1] ||\n                         html.match(/<meta[^>]*content=\"([^\"]*)\"[^>]*name=\"description\"[^>]*>/)?.[1] || ''\n      \n      // Open Graph metadata\n      const ogTitle = html.match(/<meta[^>]*property=\"og:title\"[^>]*content=\"([^\"]*)\"[^>]*>/)?.[1] || title\n      const ogDescription = html.match(/<meta[^>]*property=\"og:description\"[^>]*content=\"([^\"]*)\"[^>]*>/)?.[1] || description\n      const ogImage = html.match(/<meta[^>]*property=\"og:image\"[^>]*content=\"([^\"]*)\"[^>]*>/)?.[1] || ''\n      \n      // Favicon\n      const favicon = html.match(/<link[^>]*rel=\"icon\"[^>]*href=\"([^\"]*)\"[^>]*>/)?.[1] ||\n                     html.match(/<link[^>]*rel=\"shortcut icon\"[^>]*href=\"([^\"]*)\"[^>]*>/)?.[1] ||\n                     new URL('/favicon.ico', validUrl).href\n\n      clearTimeout(timeoutId)\n\n      return NextResponse.json({\n        title: ogTitle || validUrl.hostname,\n        description: ogDescription || '',\n        image: ogImage,\n        favicon: favicon.startsWith('http') ? favicon : new URL(favicon, validUrl).href\n      })\n    } catch (error) {\n      clearTimeout(timeoutId)\n      if (error instanceof Error) {\n        if (error.name === 'AbortError') {\n          return NextResponse.json({ error: 'Request timeout' }, { status: 408 })\n        }\n        return NextResponse.json({ error: error.message }, { status: 500 })\n      }\n      throw error\n    }\n  } catch (error) {\n    console.error('Error unfurling URL:', error)\n    return NextResponse.json(\n      { error: error instanceof Error ? error.message : 'Failed to unfurl URL' },\n      { status: 500 }\n    )\n  }\n} "],"names":[],"mappings":";;;AAAA;AACA;AACA;;;;AAEO,eAAe,KAAK,OAAgB;IACzC,IAAI;QACF,MAAM,WAAW,CAAA,GAAA,0KAAA,CAAA,2BAAwB,AAAD,EAAE;YAAE,SAAA,iIAAA,CAAA,UAAO;QAAC;QACpD,MAAM,EAAE,GAAG,EAAE,GAAG,MAAM,QAAQ,IAAI;QAElC,uBAAuB;QACvB,MAAM,EAAE,MAAM,EAAE,OAAO,EAAE,EAAE,GAAG,MAAM,SAAS,IAAI,CAAC,UAAU;QAC5D,IAAI,CAAC,SAAS;YACZ,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,eAAe;QACf,IAAI;QACJ,IAAI;YACF,WAAW,IAAI,IAAI;QACrB,EAAE,OAAO,GAAG;YACV,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAc,GAAG;gBAAE,QAAQ;YAAI;QACnE;QAEA,kCAAkC;QAClC,MAAM,aAAa,IAAI;QACvB,MAAM,YAAY,WAAW,IAAM,WAAW,KAAK,IAAI,MAAM,mBAAmB;;QAEhF,IAAI;YACF,MAAM,WAAW,MAAM,MAAM,SAAS,QAAQ,IAAI;gBAChD,QAAQ,WAAW,MAAM;gBACzB,SAAS;oBACP,cAAc;gBAChB;YACF;YAEA,IAAI,CAAC,SAAS,EAAE,EAAE;gBAChB,MAAM,IAAI,MAAM,CAAC,oBAAoB,EAAE,SAAS,MAAM,EAAE;YAC1D;YAEA,MAAM,OAAO,MAAM,SAAS,IAAI;YAEhC,4BAA4B;YAC5B,MAAM,QAAQ,KAAK,KAAK,CAAC,iCAAiC,CAAC,EAAE,IAAI;YACjE,MAAM,cAAc,KAAK,KAAK,CAAC,6DAA6D,CAAC,EAAE,IAC5E,KAAK,KAAK,CAAC,6DAA6D,CAAC,EAAE,IAAI;YAElG,sBAAsB;YACtB,MAAM,UAAU,KAAK,KAAK,CAAC,8DAA8D,CAAC,EAAE,IAAI;YAChG,MAAM,gBAAgB,KAAK,KAAK,CAAC,oEAAoE,CAAC,EAAE,IAAI;YAC5G,MAAM,UAAU,KAAK,KAAK,CAAC,8DAA8D,CAAC,EAAE,IAAI;YAEhG,UAAU;YACV,MAAM,UAAU,KAAK,KAAK,CAAC,kDAAkD,CAAC,EAAE,IACjE,KAAK,KAAK,CAAC,2DAA2D,CAAC,EAAE,IACzE,IAAI,IAAI,gBAAgB,UAAU,IAAI;YAErD,aAAa;YAEb,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;gBACvB,OAAO,WAAW,SAAS,QAAQ;gBACnC,aAAa,iBAAiB;gBAC9B,OAAO;gBACP,SAAS,QAAQ,UAAU,CAAC,UAAU,UAAU,IAAI,IAAI,SAAS,UAAU,IAAI;YACjF;QACF,EAAE,OAAO,OAAO;YACd,aAAa;YACb,IAAI,iBAAiB,OAAO;gBAC1B,IAAI,MAAM,IAAI,KAAK,cAAc;oBAC/B,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;wBAAE,OAAO;oBAAkB,GAAG;wBAAE,QAAQ;oBAAI;gBACvE;gBACA,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CAAC;oBAAE,OAAO,MAAM,OAAO;gBAAC,GAAG;oBAAE,QAAQ;gBAAI;YACnE;YACA,MAAM;QACR;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,wBAAwB;QACtC,OAAO,gIAAA,CAAA,eAAY,CAAC,IAAI,CACtB;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAuB,GACzE;YAAE,QAAQ;QAAI;IAElB;AACF","debugId":null}}]
}